{%- liquid
  comment
    Renders product items with pagination (not carousel).

    Required parameters:
      - product_items: { Object } Collection, selected products, or recommended products to show.
      - column_count_mobile: { String } The number of grid columns on mobile.
      - column_count_tablet: { String } The number of grid columns on tablet.
      - column_count_desktop: { String } The number of grid columns on desktop.
      - max_products: { Number } Limit of available product items.
      - products_per_page: { Number } Number of products to show per page.
  endcomment

  echo 'component-product-item.css' | asset_url | stylesheet_tag
  render 'inline-scripts', script_name: 'product-item'

  assign gap = '16px'
  assign gap_above_720 = '20px'
  assign gap_above_1024 = '28px'

  if column_count_desktop == '4'
    assign gap_above_1024 = '24px'
  endif

  assign has_products = false
  assign product_items_size = product_items.products.size

  if product_items != blank and product_items_size > 0
    assign has_products = true
  endif

  # Product count
  if has_products
    assign total_products = product_items_size | at_most: max_products
  else
    assign total_products = max_products
  endif

  capture paginated_id
    echo 'product-paginated-[[sid]]' | replace: '[[sid]]', section.id
  endcapture

  # Swatch data
  if settings.enable_product_listing_swatches or settings.enable_filter_swatches
    assign swatch_variant_options = settings.swatch_variant_options | split: ','

    capture custom_swatch_color_maps
      render 'get-custom-swatch-color-maps'
    endcapture

    assign custom_swatch_color_key_map = custom_swatch_color_maps | split: ' | ' | first | split: ','
    assign custom_swatch_color_value_map = custom_swatch_color_maps | split: ' | ' | last | split: ','
  endif

  # Image sizes
  capture product_item_image_sizes
    render 'get-image-sizes', type: 'grid', columns: column_count_mobile, tablet_columns: column_count_tablet, desktop_columns: column_count_desktop
  endcapture
-%}

<product-paginated data-paginated-id="{{ paginated_id }}">
<div class="product-paginated-wrap" data-paginated-id="{{ paginated_id }}" data-products-per-page="{{ products_per_page }}" data-total-products="{{ total_products }}">
  <div class="product-paginated__container">
    <div 
      class="product-paginated__grid standard-grid standard-grid--with-count-based-gaps standard-grid--with-matching-row-gaps standard-grid--mobile-{{ column_count_mobile }}-column standard-grid--desktop-{{ column_count_desktop }}-column"
      style="
        --column-count-desktop: {{ column_count_desktop }};
        --column-count-mobile: {{ column_count_mobile }};
      "
    >
      {%- if has_products -%}
        {%- for prod in product_items.products limit: max_products -%}
          <div 
            class="product-paginated__item {% if forloop.index0 >= products_per_page %}product-paginated__item--hidden{% endif %}" 
            data-product-index="{{ forloop.index0 }}"
          >
            {%- render 'product-item',
              prod: prod,
              swatch_variant_options: swatch_variant_options,
              custom_swatch_color_key_map: custom_swatch_color_key_map,
              custom_swatch_color_value_map: custom_swatch_color_value_map,
              load_animation_stagger_index: forloop.index0,
              image_sizes: product_item_image_sizes,
              index: forloop.index0
            -%}
          </div>
        {%- endfor -%}
      {%- else -%}
        {%- for i in (1..max_products) -%}
          {%- liquid
            capture placeholder_suffix
              cycle '1, 2, 3, 4'
            endcapture

            capture placeholder_name
              echo 'product-apparel-[[ps]]' | replace: '[[ps]]', placeholder_suffix
            endcapture
          -%}

          <div 
            class="product-paginated__item {% if forloop.index0 >= products_per_page %}product-paginated__item--hidden{% endif %}" 
            data-product-index="{{ forloop.index0 }}"
          >
            {%- render 'product-item',
              placeholder: true,
              placeholder_name: placeholder_name,
              swatch_variant_options: swatch_variant_options,
              custom_swatch_color_key_map: custom_swatch_color_key_map,
              custom_swatch_color_value_map: custom_swatch_color_value_map,
              load_animation_stagger_index: forloop.index0,
              image_sizes: product_item_image_sizes,
              index: forloop.index0
            -%}
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </div>
</div>
</product-paginated>

